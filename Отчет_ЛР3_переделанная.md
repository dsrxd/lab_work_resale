# Отчет по лабораторной работе: Автоматизация проектирования ПО с использованием C4-модели, DSL и ИИ-помощников (доработанная версия)

## 1. Титульный лист

| Параметр | Значение |
| --- | --- |
| **Тема работы** | Автоматизация проектирования ПО с использованием C4-модели, DSL и ИИ-помощников |
| **Проектируемая система** | Сайт продажи и перепродажи билетов на футбол |
| **Исполнитель** | Manus AI |
| **Дата выполнения** | 05 Декабря 2025 г. |

## 2. Цель работы

Целью данной лабораторной работы являлось освоение на практике принципов **Model-Driven Development (MDD)** и автоматизации технологических процессов. В частности, требовалось научиться описывать архитектуру системы с помощью **C4-модели** и текстовых **DSL (Structurizr)**, а также настраивать конвейер автоматической генерации артефактов проектирования, включая документацию и шаблонный код. 

Данная работа является доработанной версией предыдущего проекта, расширяя его функциональность **возможностью перепродажи билетов между пользователями**.

## 3. Описание этапов работы

### Этап 1: Формулировка требований и контекста (C4 Уровень 1)

**Описание системы:** Система продажи и перепродажи билетов на футбол — это онлайн-платформа, предназначенная для просмотра расписания футбольных матчей, выбора мест на стадионе и покупки электронных билетов. Ключевым отличием является наличие вторичного рынка, где пользователи могут выставлять ранее купленные билеты на продажу, а другие пользователи — их приобретать. Система обеспечивает безопасную обработку платежей как для первичных продаж, так и для сделок между пользователями, и отправку подтверждений по электронной почте.

**Использованные запросы к ИИ:**

> "Выдели основных акторов и внешние системы для сайта продажи и *перепродажи* билетов на футбол."

**Полученные результаты:** Были определены ключевые акторы (**Покупатель**, **Продавец**, **Администратор**) и внешние системы (**Платежный шлюз**, **Сервис Email-уведомлений**, **Поставщик данных о матчах**). На основе этого был создан DSL-код и сгенерирована диаграмма системного контекста (C4 Уровень 1).

**Артефакт:**

![Диаграмма Контекста](docs/c4-diagrams/context.png "Система продажи и перепродажи билетов на футбол - Контекст")

### Этап 2: Моделирование архитектуры "как код" (C4 Уровни 2-3)

#### 2.1. Контейнеры (C4 Уровень 2)

**Определение контейнеров:** Система была декомпозирована на три основных контейнера:

1.  **Web Application (React SPA):** Фронтенд для взаимодействия с пользователями.
2.  **API Application (Java Spring Boot):** Бэкенд, реализующий бизнес-логику и предоставляющий API.
3.  **Database (MySQL):** Хранилище данных.

**Артефакт:**

![Диаграмма Контейнеров](docs/c4-diagrams/containers.png "Система продажи и перепродажи билетов на футбол - Контейнеры")

#### 2.2. Компоненты (C4 Уровень 3)

**Декомпозиция контейнера "API Application":** Контейнер API Application был декомпозирован на компоненты, отражающие его расширенную функциональность, включая логику перепродажи.

-   **Контроллеры:** Ticket Controller, Match Controller, **Resale Controller**.
-   **Сервисы бизнес-логики:** User Service, Ticket Service, Match Service, **Listing Service**, **Resale Service**.
-   **Сервисы интеграции:** Payment Service, Notification Service, Match Data Service.

**Артефакт:**

![Диаграмма Компонентов](docs/c4-diagrams/components.png "API Application - Компоненты")

### Этап 3: Детальное проектирование и генерация кода

#### 3.1. Диаграмма классов (PlantUML)

**Использованные запросы к ИИ (имитация):**

> "Сгенерируй код для PlantUML диаграммы классов системы продажи и перепродажи билетов. Нужны классы: User, Match, Ticket, а также новые сущности для перепродажи, такие как Listing и ResaleTransaction. Укажи поля и связи."

**Полученные результаты:** Сгенерирован PlantUML-код, описывающий ключевые сущности и их связи, включая `Listing` (объявление о перепродаже) и `ResaleTransaction` (транзакция перепродажи).

**Артефакт:**

![Диаграмма Классов](docs/c4-diagrams/class_diagram.png "Диаграмма классов системы")

#### 3.2. OpenAPI-спецификация

На основе диаграммы классов была создана расширенная OpenAPI-спецификация в формате YAML. Она описывает как существующие эндпоинты (`GET /matches`, `POST /tickets`), так и **новые эндпоинты для управления перепродажей**:

-   `POST /listings` (создать объявление)
-   `GET /listings` (посмотреть объявления)
-   `POST /listings/{id}/purchase` (купить билет с перепродажи)
-   `DELETE /listings/{id}` (отменить объявление)

### Этап 4: Сборка и документирование конвейера

**Структура папок:** Была создана следующая структура папок, соответствующая требованиям:

```
/lab_work_resale
├── README.md
├── generate_docs.sh
├── docs
│   └── c4-diagrams
│       ├── class_diagram.puml
│       ├── components.puml
│       ├── containers.puml
│       └── context.puml
├── api-specification
│   └── openapi.yaml
└── structurizr
    └── model.dsl
```

**Скрипт автоматизации (`generate_docs.sh`):** Был создан bash-скрипт, который имитирует выполнение следующих шагов:

1.  Копирование DSL-файла в директорию для Structurizr (в данном случае эмуляция, т.к. генерация шла через PlantUML).
2.  Генерация диаграмм C4 и диаграммы классов с помощью `plantuml.jar`.
3.  Копирование сгенерированных артефактов в папку с документацией.

**Файл README.md:** Создан файл README.md, содержащий описание системы, упоминание диаграмм контекста, ссылку на OpenAPI-спецификацию и инструкцию по запуску скрипта.

## 4. Вложенные сгенерированные артефакты

Ввиду ограничений среды, визуализированные диаграммы были сгенерированы из исходных PlantUML-файлов. Все артефакты прилагаются:

-   **Архитектура C4 (DSL):** `structurizr/model.dsl`
-   **Диаграммы (PlantUML):** `docs/c4-diagrams/*.puml`
-   **Спецификация API (OpenAPI YAML):** `api-specification/openapi.yaml`
-   **Скрипт автоматизации:** `generate_docs.sh`
-   **README проекта:** `README.md`

## 5. Выводы по работе

В ходе доработки лабораторной работы был успешно освоен и расширен подход "Архитектура как код" с использованием C4-модели и текстовых DSL. Была разработана полная архитектурная модель системы продажи и перепродажи билетов на футбол, охватывающая уровни Context (L1), Containers (L2) и Components (L3).

**Что получилось:**

-   Успешно разработана иерархическая архитектурная модель в текстовом формате DSL, включающая функциональность перепродажи.
-   Создана детальная диаграмма классов для ключевых сущностей, включая `Listing` и `ResaleTransaction`.
-   Сформирована расширенная OpenAPI-спецификация для бэкенда с новыми эндпоинтами.
-   Настроен конвейер автоматизации (`generate_docs.sh`), демонстрирующий принцип MDD и генерации артефактов.

**Роль ИИ-помощника:** ИИ-помощник (в данном случае, Manus AI) взял на себя роль, описанную в задании:

-   **Анализ требований:** Помог в определении ключевых акторов, внешних систем и новых сущностей для функции перепродажи.
-   **Генерация DSL-кода:** Создал структурированный DSL-код для C4-модели и PlantUML-код для диаграммы классов, что значительно ускорило процесс проектирования и минимизировало рутинную работу.

Таким образом, лабораторная работа продемонстрировала эффективность использования текстовых DSL и автоматизации для создания и поддержания актуальной архитектурной документации в более сложном проекте.
